var G=Object.defineProperty;var j=(e,t,i)=>t in e?G(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var h=(e,t,i)=>j(e,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();function T(e){return e*Math.PI/180}var R=1e-6,w=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function q(){var e=new w(9);return w!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function S(){var e=new w(16);return w!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function H(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function X(e,t,i){var r=i[0],n=i[1],s=i[2],a,o,c,u,d,l,p,f,v,x,m,E;return t===e?(e[12]=t[0]*r+t[4]*n+t[8]*s+t[12],e[13]=t[1]*r+t[5]*n+t[9]*s+t[13],e[14]=t[2]*r+t[6]*n+t[10]*s+t[14],e[15]=t[3]*r+t[7]*n+t[11]*s+t[15]):(a=t[0],o=t[1],c=t[2],u=t[3],d=t[4],l=t[5],p=t[6],f=t[7],v=t[8],x=t[9],m=t[10],E=t[11],e[0]=a,e[1]=o,e[2]=c,e[3]=u,e[4]=d,e[5]=l,e[6]=p,e[7]=f,e[8]=v,e[9]=x,e[10]=m,e[11]=E,e[12]=a*r+d*n+v*s+t[12],e[13]=o*r+l*n+x*s+t[13],e[14]=c*r+p*n+m*s+t[14],e[15]=u*r+f*n+E*s+t[15]),e}function W(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function J(e,t,i,r,n){var s=1/Math.tan(t/2),a;return e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,n!=null&&n!==1/0?(a=1/(r-n),e[10]=(n+r)*a,e[14]=2*n*r*a):(e[10]=-1,e[14]=-2*r),e}var K=J;function Q(e,t,i,r){var n,s,a,o,c,u,d,l,p,f,v=t[0],x=t[1],m=t[2],E=r[0],D=r[1],z=r[2],I=i[0],Y=i[1],N=i[2];return Math.abs(v-I)<R&&Math.abs(x-Y)<R&&Math.abs(m-N)<R?H(e):(d=v-I,l=x-Y,p=m-N,f=1/Math.hypot(d,l,p),d*=f,l*=f,p*=f,n=D*p-z*l,s=z*d-E*p,a=E*l-D*d,f=Math.hypot(n,s,a),f?(f=1/f,n*=f,s*=f,a*=f):(n=0,s=0,a=0),o=l*a-p*s,c=p*n-d*a,u=d*s-l*n,f=Math.hypot(o,c,u),f?(f=1/f,o*=f,c*=f,u*=f):(o=0,c=0,u=0),e[0]=n,e[1]=o,e[2]=d,e[3]=0,e[4]=s,e[5]=c,e[6]=l,e[7]=0,e[8]=a,e[9]=u,e[10]=p,e[11]=0,e[12]=-(n*v+s*x+a*m),e[13]=-(o*v+c*x+u*m),e[14]=-(d*v+l*x+p*m),e[15]=1,e)}function P(){var e=new w(3);return w!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Z(e){var t=new w(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function k(e){var t=e[0],i=e[1],r=e[2];return Math.hypot(t,i,r)}function _(e,t,i){var r=new w(3);return r[0]=e,r[1]=t,r[2]=i,r}function tt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function B(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e}function $(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function y(e,t){var i=t[0],r=t[1],n=t[2],s=i*i+r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function et(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function L(e,t,i){var r=t[0],n=t[1],s=t[2],a=i[0],o=i[1],c=i[2];return e[0]=n*c-s*o,e[1]=s*a-r*c,e[2]=r*o-n*a,e}function F(e,t,i){var r=i[0],n=i[1],s=i[2],a=i[3],o=t[0],c=t[1],u=t[2],d=n*u-s*c,l=s*o-r*u,p=r*c-n*o,f=n*p-s*l,v=s*d-r*p,x=r*l-n*d,m=a*2;return d*=m,l*=m,p*=m,f*=2,v*=2,x*=2,e[0]=o+d+f,e[1]=c+l+v,e[2]=u+p+x,e}var rt=k;(function(){var e=P();return function(t,i,r,n,s,a){var o,c;for(i||(i=3),r||(r=0),n?c=Math.min(n*i+r,t.length):c=t.length,o=r;o<c;o+=i)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],s(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2];return t}})();function it(){var e=new w(4);return w!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function nt(e,t){var i=t[0],r=t[1],n=t[2],s=t[3],a=i*i+r*r+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=i*a,e[1]=r*a,e[2]=n*a,e[3]=s*a,e}(function(){var e=it();return function(t,i,r,n,s,a){var o,c;for(i||(i=4),r||(r=0),n?c=Math.min(n*i+r,t.length):c=t.length,o=r;o<c;o+=i)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],s(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}})();function b(){var e=new w(4);return w!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function st(e,t,i){i=i*.5;var r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function U(e,t,i,r){var n=t[0],s=t[1],a=t[2],o=t[3],c=i[0],u=i[1],d=i[2],l=i[3],p,f,v,x,m;return f=n*c+s*u+a*d+o*l,f<0&&(f=-f,c=-c,u=-u,d=-d,l=-l),1-f>R?(p=Math.acos(f),v=Math.sin(p),x=Math.sin((1-r)*p)/v,m=Math.sin(r*p)/v):(x=1-r,m=r),e[0]=x*n+m*c,e[1]=x*s+m*u,e[2]=x*a+m*d,e[3]=x*o+m*l,e}function at(e,t){var i=t[0]+t[4]+t[8],r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);var s=(n+1)%3,a=(n+2)%3;r=Math.sqrt(t[n*3+n]-t[s*3+s]-t[a*3+a]+1),e[n]=.5*r,r=.5/r,e[3]=(t[s*3+a]-t[a*3+s])*r,e[s]=(t[s*3+n]+t[n*3+s])*r,e[a]=(t[a*3+n]+t[n*3+a])*r}return e}function ot(e,t,i,r){var n=.5*Math.PI/180;t*=n,i*=n,r*=n;var s=Math.sin(t),a=Math.cos(t),o=Math.sin(i),c=Math.cos(i),u=Math.sin(r),d=Math.cos(r);return e[0]=s*c*d-a*o*u,e[1]=a*o*d+s*c*u,e[2]=a*c*u-s*o*d,e[3]=a*c*d+s*o*u,e}var V=nt;(function(){var e=P(),t=_(1,0,0),i=_(0,1,0);return function(r,n,s){var a=et(n,s);return a<-.999999?(L(e,t,n),rt(e)<1e-6&&L(e,i,n),y(e,e),st(r,e,Math.PI),r):a>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(L(e,n,s),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+a,V(r,r))}})();(function(){var e=b(),t=b();return function(i,r,n,s,a,o){return U(e,r,a,o),U(t,n,s,o),U(i,e,t,2*o*(1-o)),i}})();(function(){var e=q();return function(t,i,r,n){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-i[0],e[5]=-i[1],e[8]=-i[2],V(t,at(t,e))}})();class ht{constructor(t){h(this,"config");h(this,"_projectionMatrix");h(this,"_viewMatrix");h(this,"position");h(this,"rotation");h(this,"up");h(this,"forward");h(this,"right");this.config=t,this._projectionMatrix=S(),this._viewMatrix=S(),this.position=_(0,0,5),this.rotation=b(),this.up=_(0,1,0),this.forward=_(0,0,-1),this.right=_(1,0,0),this.updateProjectionMatrix(),this.updateViewMatrix()}updateProjectionMatrix(){const t=this.config.size.width/this.config.size.height;K(this._projectionMatrix,this.config.fov,t,.1,1e3)}updateViewMatrix(){const t=P();$(t,this.position,this.forward),Q(this._viewMatrix,this.position,t,this.up)}setPosition(t){tt(this.position,t),this.updateViewMatrix()}getPosition(){return Z(this.position)}setRotation(t){const i=T(t[0]),r=T(t[1]),n=T(t[2]);ot(this.rotation,i,r,n),B(this.forward,0,0,-1),F(this.forward,this.forward,this.rotation),y(this.forward,this.forward),B(this.right,1,0,0),F(this.right,this.right,this.rotation),y(this.right,this.right),B(this.up,0,1,0),F(this.up,this.up,this.rotation),y(this.up,this.up),this.updateViewMatrix()}translate(t){$(this.position,this.position,t),this.updateViewMatrix()}get projectionMatrix(){return this._projectionMatrix}get viewMatrix(){return this._viewMatrix}}const g=class g{constructor(t,i,r){h(this,"gl");h(this,"program");this.gl=t,this.program=this.createProgram(i,r)}createShader(t,i){const r=this.gl.createShader(t);if(!r)throw new Error("Shader creation failed");if(this.gl.shaderSource(r,i),this.gl.compileShader(r),!this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)){const s=this.gl.getShaderInfoLog(r);throw this.gl.deleteShader(r),new Error(`Shader compilation failed: ${s}`)}return r}createProgram(t,i){const r=this.createShader(this.gl.VERTEX_SHADER,t),n=this.createShader(this.gl.FRAGMENT_SHADER,i),s=this.gl.createProgram();if(!s)throw new Error("Program creation failed");if(this.gl.attachShader(s,r),this.gl.attachShader(s,n),this.gl.linkProgram(s),!this.gl.getProgramParameter(s,this.gl.LINK_STATUS)){const o=this.gl.getProgramInfoLog(s);throw new Error(`Program linking failed: ${o}`)}return s}use(){this.gl.useProgram(this.program)}setMatrix(t,i,r){this.gl.uniformMatrix4fv(this.getUniformLocation(g.VOCABULARY.uniform.projectionMatrix),!1,t),this.gl.uniformMatrix4fv(this.getUniformLocation(g.VOCABULARY.uniform.viewMatrix),!1,i),this.gl.uniformMatrix4fv(this.getUniformLocation(g.VOCABULARY.uniform.modelMatrix),!1,r)}setTexture(t){this.gl.uniform1i(this.getUniformLocation(g.VOCABULARY.uniform.useTexture),1),this.gl.uniform4f(this.getUniformLocation(g.VOCABULARY.uniform.color),1,1,1,1),this.gl.bindTexture(this.gl.TEXTURE_2D,t.getTexture())}setColor(t){this.gl.uniform1i(this.getUniformLocation(g.VOCABULARY.uniform.useTexture),0),this.gl.uniform4f(this.getUniformLocation(g.VOCABULARY.uniform.color),t[0],t[1],t[2],t[3])}getAttribLocation(t){const i=this.gl.getAttribLocation(this.program,t);if(i===-1)throw new Error(`Attribute ${t} not found`);return i}getUniformLocation(t){return this.gl.getUniformLocation(this.program,t)}};h(g,"VOCABULARY",{attribute:{position:"a_position",texture:"a_texCoord"},uniform:{projectionMatrix:"u_projectionMatrix",viewMatrix:"u_viewMatrix",modelMatrix:"u_modelMatrix",color:"u_color",texture:"u_texture",useTexture:"u_useTexture"}});let M=g;const ct=`#version 300 es
precision mediump float;

// Vertex attributes
in vec4 a_position;
in vec2 a_texCoord;

// Matrices
uniform mat4 u_projectionMatrix;
uniform mat4 u_viewMatrix;
uniform mat4 u_modelMatrix;

out vec2 v_texCoord;

void main() {
  gl_Position = u_projectionMatrix * u_viewMatrix * u_modelMatrix * a_position;
  v_texCoord = a_texCoord;
}`,ft=`#version 300 es
precision mediump float;

uniform vec4 u_color;
uniform bool u_useTexture;
uniform sampler2D u_texture;

in vec2 v_texCoord;

out vec4 outColor;

void main() {
    if (u_useTexture) {
      outColor = texture(u_texture, v_texCoord) * u_color;
    }
    else {
      outColor = u_color;
    }
}`;function dt(e){const t=new M(e,ct,ft);if(!t)throw new Error("Shader creation failed");return t}class ut{constructor(t){h(this,"canvas");h(this,"gl");h(this,"state");h(this,"shader",new Map);h(this,"renderList",new Map);h(this,"camera");if(this.state=this.getDefaultState(),this.updateState("starting","Triton is starting..."),this.canvas=t.canvas||document.createElement("canvas"),t.size?(this.canvas.width=t.size.width,this.canvas.height=t.size.height):(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,window.onresize=()=>this.handleResize()),document.body.contains(this.canvas)||document.body.appendChild(this.canvas),this.gl=this.canvas.getContext("webgl2"),!this.gl)throw this.updateState("error","WebGL2 not supported"),new Error("WebGL2 not supported");this.glConfig(),this.camera=new ht({fov:45,size:{width:this.canvas.width,height:this.canvas.height}}),this.updateState("running","Triton started successfully")}get State(){return this.state}get Canvas(){return this.canvas}getDefaultState(){return{state:"idle",log:[]}}updateState(t,i){this.state.state=t,this.state.log.push(i)}handleResize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}glConfig(){this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.compileShaders()}compileShaders(){this.shader.set("unlit",dt(this.gl))}addSprite(t,i){this.renderList.has(t)&&console.warn(`Sprite with name ${t} already exists. Overwriting.`),this.renderList.set(t,i),i.init(this.gl,this.shader.get("unlit"))}removeSprite(t){var i;this.renderList.has(t)?((i=this.renderList.get(t))==null||i.destroy(this.gl),this.renderList.delete(t)):console.warn(`Sprite with name ${t} does not exist.`)}getSprite(t){return this.renderList.get(t)}clearRenderList(){this.renderList.forEach(t=>{t.destroy(this.gl)}),this.renderList.clear()}renderFrame(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.renderList.forEach(t=>{t.render(this.camera.projectionMatrix,this.camera.viewMatrix,this.gl)})}clear(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}}let lt=0;const C=new Map;class pt{constructor(t){h(this,"imagePath");h(this,"texture",null);h(this,"textureUnit",lt);this.imagePath=t}init(t){if(C.has(this.imagePath)){this.texture=C.get(this.imagePath);return}if(this.texture=t.createTexture(),!this.texture)throw new Error("[ X ] Texture creation failed");t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([255,0,255,255]));const i=new Image;i.src=this.imagePath,i.onload=()=>{t.bindTexture(t.TEXTURE_2D,this.texture),t.activeTexture(this.textureUnit),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),t.generateMipmap(t.TEXTURE_2D),C.set(this.imagePath,this.texture)}}getTexture(){return this.texture}destroy(t){this.texture&&(t.deleteTexture(this.texture),this.texture=null)}}const A={shapes:{Square:{vertices:[-.5,-.5,0,1,.5,-.5,0,1,.5,.5,0,1,-.5,.5,0,1],indices:[0,1,2,2,3,0],texCords:[0,1,1,1,1,0,0,0]}}};class mt{constructor(t){h(this,"vertexBuffer",null);h(this,"indexBuffer",null);h(this,"textureCoordBuffer",null);h(this,"modelMatrix",null);h(this,"shader",null);h(this,"texture",null);h(this,"position",[0,0]);this.texture=new pt(t)}move(t,i){this.modelMatrix&&(this.modelMatrix=X(this.modelMatrix,S(),[t,i,0]))}init(t,i){if(this.vertexBuffer=t.createBuffer(),!this.vertexBuffer)throw new Error("Vertex buffer creation failed");if(t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(A.shapes.Square.vertices),t.STATIC_DRAW),this.indexBuffer=t.createBuffer(),!this.indexBuffer)throw new Error("Index buffer creation failed");if(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(A.shapes.Square.indices),t.STATIC_DRAW),this.textureCoordBuffer=t.createBuffer(),!this.textureCoordBuffer)throw new Error("Texture coordinate buffer creation failed");if(t.bindBuffer(t.ARRAY_BUFFER,this.textureCoordBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(A.shapes.Square.texCords),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),this.shader=i,!this.shader)throw new Error("Shader creation failed");if(!this.texture)throw new Error("Texture creation failed");this.texture.init(t),this.modelMatrix=W(S(),_(this.position[0],this.position[1],0))}destroy(t){t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.indexBuffer),this.vertexBuffer=null,this.indexBuffer=null,this.modelMatrix=null,this.shader=null}setPosition(t,i){this.position=[t,i]}render(t,i,r){if(!this.vertexBuffer||!this.indexBuffer||!this.modelMatrix||!this.texture||!this.shader)return;this.shader.use(),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer);const n=this.shader.getAttribLocation(M.VOCABULARY.attribute.position);r.enableVertexAttribArray(n),r.vertexAttribPointer(n,4,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this.textureCoordBuffer);const s=this.shader.getAttribLocation(M.VOCABULARY.attribute.texture);r.enableVertexAttribArray(s),r.vertexAttribPointer(s,2,r.FLOAT,!1,0,0),this.shader.setMatrix(t,i,this.modelMatrix),this.shader.setTexture(this.texture),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer),r.drawElements(r.TRIANGLES,A.shapes.Square.indices.length,r.UNSIGNED_SHORT,0),r.bindBuffer(r.ARRAY_BUFFER,null),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null)}}function xt(e,t){return t instanceof Map?{dataType:"Map",value:Array.from(t.entries())}:t}function vt(e,t){return typeof t=="object"&&t!==null&&t.dataType==="Map"?new Map(t.value):t}function wt(e,t=0){return JSON.stringify(e,xt,t)}function gt(e){return JSON.parse(e,vt)}function _t(e){const t=gt(e);if(!t)throw new Error("Failed to load game data");if(!t.metadata)throw new Error("Game data does not contain metadata");return t}class Et{constructor(t){h(this,"_id");h(this,"_name");h(this,"_components");h(this,"_attachedScripts");this._id=t.id,this._name=t.name,this._components=t.components||[],this._attachedScripts=new Map}getComponent(t){const i=this._components.find(r=>r.type===t);return i?i.data:null}attachScript(t){if(this._attachedScripts.has(t.name))throw new Error(`Script with ID ${t.name} is already attached`);this._attachedScripts.set(t.name,t)}detachScript(t){if(!this._attachedScripts.has(t))throw new Error(`Script with ID ${t} is not attached`);this._attachedScripts.delete(t)}getScripts(){return Array.from(this._attachedScripts.values())}getComponents(t){return this._components.filter(i=>i.type===t)}addComponent(t){if(this._components.find(i=>i.type===t.type))throw new Error(`Component of type ${t.type} already exists`);this._components.push(t)}removeComponent(t){const i=this._components.findIndex(r=>r.type===t);if(i===-1)throw new Error(`Component of type ${t} does not exist`);this._components.splice(i,1)}get id(){return this._id}get name(){return this._name}}const Mt={test:()=>{console.log("Script context test function called.")}};class At{constructor(t,i){h(this,"_name");h(this,"_scriptFunctions",new Map);var r;if(this._name=t,i.scriptURL)throw new Error("Script URL is not supported yet.");if(i.scriptData){const n=this.loadScriptFunctions(i.scriptData);if(!n)throw new Error("Failed to load script functions.");this._scriptFunctions=n,(r=this._scriptFunctions.get("Start"))==null||r.call({...Mt})}else throw new Error("No script data provided.")}loadScriptFunctions(t){try{const i=`
        ${t}
        return exports;  
      `,n=new Function(i)(),s=new Map;for(const a in n)typeof n[a]=="function"?(s.has(a)&&console.warn(`Function ${a} is already defined. Overwriting.`),s.set(a,n[a])):console.warn(`Exported value ${a} is not a function.`);return s}catch(i){console.error("Error loading script functions:",i)}}get name(){return this._name}}class Rt{constructor(t){h(this,"triton");h(this,"running",!1);h(this,"game",null);h(this,"scene",null);h(this,"objects",new Map);t.render.render?this.triton=t.render.render:this.triton=new ut({canvas:t.render.canvas})}update(){if(!this.running){this.triton.clear();return}this.triton.renderFrame(),requestAnimationFrame(this.update.bind(this))}start(){this.running=!0,this.update()}stop(){this.running=!1}loadScene(){if(!this.scene)throw new Error("No scene loaded");this.triton.clearRenderList(),this.objects=new Map,this.scene.objects.forEach(t=>{const i=new Et(t);if(this.objects.set(t.name,i),!t.components){console.warn(`Object ${t.name} has no components`);return}t.components.forEach(r=>{switch(r.type){case"sprite":const n=r.data;if(!n.textureLocation){console.warn(`Sprite component for object ${t.name} has no path. Also object data might be missing or wrong.`);return}const s=new mt(n.textureLocation);if(!i.getComponent("transform")){console.error(`Object ${t.name} has no transform component. Cannot use sprite component.`);return}const a=i.getComponent("transform");if(!a){console.error(`Transform component for object ${t.name} is missing or wrong.`);return}s.setPosition(a.position[0],a.position[1]),this.triton.addSprite(t.name,s);break;case"script":const o=i.getComponent("script");if(!o){console.error(`Script component for object ${t.name} is missing or wrong.`);return}const c=new At(t.name,o);i.attachScript(c);break}r.type})})}saveGame(){if(!this.game)throw new Error("No game loaded");const t=this.game,i=wt(t,2),r=new Blob([i],{type:"application/json"}),n=URL.createObjectURL(r),s=document.createElement("a");s.href=n,s.download="game.json",s.click(),URL.revokeObjectURL(n),console.log("Game saved to game.json")}async loadGame(t){const r=await(await fetch(t)).text(),n=_t(r);if(this.triton.clearRenderList(),n.currentScene||(console.warn("No current scene set in game data. Defaulting to first scene."),n.currentScene=Array.from(n.scenes.keys())[0]),this.scene=n.scenes.get(n.currentScene),!this.scene)throw new Error(`Scene ${n.currentScene} not found`);this.loadScene(),this.game=n}}const O=new Rt({render:{}});O.loadGame("games/test.json").then(()=>{O.start()});window.Hydra=O;
